--- 
title: "Spacial and Temporal analysis of Flowers by 5 Grid"
subtitle: "Prepared for Ermatinger Lochlin"
author: 
- Primary Statistician, Statistician
- Secondary Statistician, Statistician
- Director Name, Director
authors: 
  name: Will Hammond and Gifty Osei 
  affiliation: Statistical Consulting and Research Services  

secondary: 
  name: Riley
  affiliation: Statistical Consulting and Research Services
director:  
  name: Director Name
  affiliation: Statistical Consulting and Research Services  

abstract: |
  **Author Note:**  
  
  This material is provided to communicate advice from SCRS statisticians based on our best understanding of your research needs. We encourage you to use this report in discussions with colleagues. Please do not publish any portion of this material without permission.  
  
  © Primary Statistician
  
  When you make use of our work for publications or presentations, please be sure to acknowledge the funding we receive from NIGMS using the following: “Research reported in this publication was supported by Institutional Development Awards (IDeA) from the National Institute of General Medical Sciences of the National Institutes of Health under Awards P20GM103474, U54GM115371, 5P20GM104417, and 2U54GM104944-06. The content is solely the responsibility of the authors and does not necessarily represent the official views of the National Institutes of Health.  
prelim: yes
date: "**`r format(Sys.time(), '%B %d, %Y')`**"
titlepage: yes
msucolor: yes
twoside: yes
spacing: 1
bibliography: [scrs-ref.bib, packages.bib]
biblio-style: apalike
link-citations: yes
colorlinks: yes
site: bookdown::bookdown_site
documentclass: article
---


```{r import, echo = FALSE}
# Some other useful knitr options:
# fig.retina: multiplicative factor for figures' resolution
knitr::opts_chunk$set(echo = TRUE, cache = FALSE, message = FALSE,
               comment = NA, size = 'footnotesize', width = 80,
               warning = FALSE, show.signif.stars = FALSE,
               fig.height=5, fig.width=10)
```

```{r packages, include=FALSE}
# automatically create a bib database for R packages, list used packages here
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown', 'readr', 'readxl', 'dplyr', 'mosaic',
  'nlme', 'yarrr', 'predictmeans','tibble', 'ggplot2', 'effects'), 'packages.bib')
```

```{r echo=F}
# load all required packages first, edit this list as required.
library(readr)
library(readxl)
library(dplyr)
library(mosaic)
library(knitr)
library(yarrr)
library(nlme)
library(predictmeans)
library(effects)
library(tibble)
suppressMessages(library(stringr))
```


# Introduction {#intro}

Montana's most important region of wheat production is colloquially referred to as the Golden Triangle(GT). The area owes its agricultural prominence to the grasslands that they were converted from. It has been estimated that 73$\%$ of the grassland that were present in the GT prior ro European settlement of region have been lost to land conversion. In the case of wheat production, the balance between an insect pest of wheat (the wheat stem sawfly) and its natural enemies has been disrupted, resulting in epidemic outbreaks of wheat steam sawfly(WSS) infestation in wheat fields.The specialist parasitoids B. cephi and B. lissogaster require a WSS larvae feeding inside a grass or wheat stem as host for their offspring. They also require diets rich in carbohydrates and other nutrients compounds to achieve maximum livelihood and increase traits associated with fecundity. Because little is known about the floral resources that may be important to the parasitoids, a two year survey was conducted of an intact grassland plot(12 ha) located within the GT. During each survey(~6 per season, every two weeks) we recorded the location, species, and quantity of actively flowering plants encountered. We also retrieved LiDAR digital elevation model and daily weather observations to model the spatiotemporal context of our observed flowering plants. This model may help us to understand which species of flora warrant further investigation as supplemental resources for the specialist parasitoids of WSS based on their temporal alignment with the braconids's phenology and observed spatial distribution. We anticipate the culmination of this project will help inform future research on providing supplemental nutrition to parasitoids of WSS in the field setting. We would like to identify plants native to our study region that may provide the parasitoids with similar benefits to that of buck wheat and cowpea. 



## Data Collection 

Surveys of flowering plants were conducted on a 12-ha relic grassland located on the northern Agricultural Research Center (NARC), south of Havre, Montana. The mean annual precipitation recorded in Havre over the past 30 years is 305 mm and the average temperature is 9 degress C. This grassland site has been protected from development and livestock grazing since 1916, making the present flora similar to what may inhabit analogous areas in the absence of anthropogenic factors.

Trips to the site were made every two weeks between June and September of 2019 and 2020. Belt transects 10 meters wide running the length of the site were plotted. The distance between each transect was also 10 meters, effectively meaning half of the site was surveyed. The lowland areas in the center of the plot was excluded due to the difficulty of sampling presented by the dense vegetation. Surveys consisted of the GPS location, species, and quantity of the actively flowering plants. To diminish impacts on the area and plant disturbances, photos were taken for later species identification. Sampling locations were resampled to a 5 meter grid to account for unknown spatial accuracy of the GPS unit used (Garmin Oregon 450). In total we collected 9720 point observations of actively flowering plants from 61 different species. Each point observation consists of the specie(s) observed, status of species in Montana (i.e. weed, native, species of concern, etc...) quantity of species, latitude, longitude , date the observation was recorded.


# Data Description and Methods

The data that were used for this paper came from three primary sources. The first is a list of all flower species that were found on the plot of land the data were collected from. There were 65 species, each of which had their scientific and common names included, as well as a Montana Field Guide Conservation Score. This score takes on integer values from 0 to 5, indicating how well each species can respond to changes in the surrounding environment. One of the filters that was used for determining ideal candidate species was having a score of 2 or 3, which indicates that a species can grow in a wide range of environments and adapt well to changes, but is not invasive either.


\newline The second file contains weather data for a station near the plot of land. For each day in 2019 and 2020, information is included for mean air temperature in degrees Celsius, mean soil temperature in degrees Celsius at depths of 0, 4, 8, 20 and 36 inches and millimeters of precipitation received. When calculating growing degree days, the difference between mean daily temperature and a particular threshold temperature (0 and 4 degrees Celsius were considered) is the value for growing degree days for a given day if that value is positive and 0 otherwise. Values for growing degree days for each day as well as cumulative growing degree days for a year were calculated.


<<<<<<< HEAD
\newline For six dates in 2019 and five dates in 2020, data were collected at numerous different points throughout the plot. Within a certain distance of each of these points, which was typically a few meters, it was noted which flower species were present and in what quantity. The notable variables included x and y coordinates, mean elevation in feet, mean aspect, which takes on a value from 0 to 360 and corresponds to which direction the slope faces, mean slope in degrees and mean roughness. 
#what is roughness, possible values and units
=======
\newline For six dates in 2019 and five dates in 2020, data were collected at numerous different points throughout the plot. Within a certain distance of each of these points, which was typically a few meters, it was noted which flower species were present and in what quantity. The notable variables included x and y coordinates, mean elevation in feet, mean aspect, which takes on a value from 0 to 360 and corresponds to which direction the slope faces, mean slope in degrees and mean roughness. For the purpose of modeling, aspect was transformed to an indicator for north facing slopes. That is, 1 if the mean aspect was between 0 and 90 or 270 and 360, and 0 otherwise.
>>>>>>> 3cd2b866c19ab37ddc0ecfcb911bd13b52556081

# Poisson Point Process Models

An inhomogenous poisson point process model was used to glean insights to the distribution of species in terms of favorable or unfavorable terrain characteristics. The approach used was to fit an individual model for each species. These models are based on two main assumptions: 

1. Observed points are independent of each other. That is, the presence of one point in a region, $B \subset \mathbb{R}^2$, is not related to the presence of other points in the same region.

2. The number of points (flower observations) within a region,B, has a poisson distribution, and the expected count of points within a region is = $\int_{region}\lambda(u)du$, where $\lambda(u)$ is the intensity (average number of points per unit area) of points at the location $u \in B$.

Each model produces an intensity surface across the survey area according to log-linear poisson likelihood, where the points $u$ correspond to pixels in the survey area.

$$P(N(u)) \sim Pois(\lambda(u))$$

To estimate the intensity with respect to the terrain covariates we use a log-linear intensity function:

$$ \lambda(u)=exp(\beta_0 + \beta_1aspect_u + \beta_2slope_u + \beta_3roughness_u) $$

Here, the log-linear intensity function imposes another assumption, that intensity increases or decreases exponentially as a function of aspect, slope, and roughness. 

Aspect was defined as a 1 for northfacing areas and 0 for south facing areas. The coefficients $\beta$ represent the expected increase in log-intensity for a 1 unit increase in the corresponding variable (aspect, roughness, slope). $\beta$ with large magnitude represent strong underlying relationships with terrain covariates for a given species, while $\beta$ close to 0 indicate that the species is relatively unaffected by the terrain covariate.  

The model coefficients then represent estimates of the relationship between a species presence at a given location with observed terrain characteristics. For the context of understanding the individual terrain preferences of a species, the magnitude of the estimated coefficients represent the relative importance of a particular terrain covariate. For example, a species with a large estimated coefficient on aspect is more likely to grow on a north facing slope. To identify species which will grow well on any given terrain, species with low-magnitude coefficients should be prioritized.

# Limitations

There is likely some large violation of the assumption of point-wise independence. From visual investigation of flower observations, there is evidence of some clustering, especially with respect to those species with limited observations. We recommend limiting inferences from this modeling approach to species with many observations that don't appear to violate the assumption of independence. Although not considered here, Ripley's K-function can quantify the degree of clustering for a given species. 

The assumption of a log-linear intensity with respect to terrain covariates limits the intensity to be exponential and uni-directional as a function of a given terrain covariate. This means that for a given species, the relationship between a particular terrain covariate and the estimated intensity can only increase or decrease in an exponential form. Considering that a species may have an "optimal" terrain type, future work should aim to fit a similar model that includes polynomial terrain coefficients, for example, $roughness^2$. The introduction of polynomial predictors will allow for bi-directional intensities as a function fo particular terrain covariates.

Additionally, interaction terms were not considered in these models, although the true existance of interaction effects may exist. For example slope may mediate the relationship of intensity with roughness. That is, a species may grow poorly on rough terrain with a low slope, but may grow particularly well on rough terrain with a high slope. Future modeling should consider the existance of interaction effects between terrain covariates. 

# Results

Given the sparsity of some species, we limit inferences from the modeling approach to species with greater than 50 observations. 

```{r}
load("flower_df_final.RData")

print(flower_inf_50)
```



## Including Figures and Tables created by R code



### Adding a Figure

Make sure that figures have a `fig.cap` (figure caption). You can use either `out.width` for sizing or `fig.height` and `fig.width`. To get R to scale graphics appropriately I find that oversizing a figure works nicely. For example, even though letter paper is 8.5" x 11" I will set a figure that I want to use half the page to `fig.width=10` and `fig.height=6`.

```{r nice-fig, fig.cap='Here is a nice figure!', out.width='80%', fig.asp=.75, fig.align='center'}
par(mar = c(4, 4, .1, .1))
plot(pressure, type = 'b', pch = 19)
```

Reference a figure by its code chunk label with the `fig:` prefix, e.g., see Figure \@ref(fig:nice-fig). 

### Adding a Table

Similarly, you can reference tables generated from `knitr::kable()`, e.g., see Table \@ref(tab:nice-tab).

```{r nice-tab, tidy=FALSE}
knitr::kable(
  head(iris, 20), caption = 'Here is a nice table!',
  booktabs = TRUE
)
```

## Including graphics or figures not created by R

Did you know the `yarr` package has several images in it? The images are there because they were used to create the palates in the package. Let's import one of those images. Since I don't know where the `yarrr` package is stored on your computer and the delimiter used by your operating system, I will use R functions to find the path and to create the file path.

```{r fig.cap="Finding nemo image from yarr package.", out.width="80%"}
knitr::include_graphics(file.path(path.package("yarrr"), "nemo.jpg"))
```

## Including citations

You can write citations, too. For example, this is R [@R] and the most referenced book is [@Ramsey2012].

If a package is used and cited it will be included in the references section. Edit the following list of packages below.

# Packages used

The R package `bookdown` [@R-bookdown] was used to create this report document using the `R` language [@R-base]. In addition, the following were packages used for the analysis and/or formatting of this document:

- `knitr` [@R-knitr]
- `rmarkdown` [@R-rmarkdown]
- `readr` [@R-readr]
- `readxl` [@R-readxl]
- `tibble` [@R-tibble]
- `dplyr` [@R-dplyr]
- `mosaic` [@R-mosaic]
- `nlme` [@R-nlme]
- `yarrr` [@R-yarrr]
- `ggplot2` [@R-ggplot2]
- `effects` [@R-effects]
- `predictmeans` [@R-predictmeans]

# References

